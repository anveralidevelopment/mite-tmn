<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–Ω–∏—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–µ—â–µ–π - –¢—é–º–µ–Ω—å</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=2.3">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">–ú–æ–Ω–∏—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–µ—â–µ–π</h1>
                <p class="subtitle">–¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" id="exportBtn" onclick="showExportMenu()">
                    <span class="btn-icon">üì•</span>
                    –≠–∫—Å–ø–æ—Ä—Ç
                </button>
                <button class="btn btn-secondary" id="themeBtn" onclick="toggleTheme()">
                    <span class="btn-icon">üåô</span>
                    –¢–µ–º–∞
                </button>
                <button class="btn btn-primary" id="updateBtn" onclick="updateData()">
                    <span class="btn-icon">‚Üª</span>
                    –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
        </header>
        
        <!-- Export Menu -->
        <div id="exportMenu" class="export-menu" style="display: none;">
            <div class="export-menu-content">
                <h3>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="export-options">
                    <button class="btn btn-export" onclick="exportData('csv')">üìÑ CSV</button>
                    <button class="btn btn-export" onclick="exportData('excel')">üìä Excel</button>
                    <button class="btn btn-export" onclick="exportData('pdf')">üìë PDF</button>
                </div>
                <button class="btn btn-close" onclick="hideExportMenu()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è</div>
                <div class="stat-value" id="currentCases">-</div>
                <div class="stat-date" id="currentDate">-</div>
                <div class="stat-risk" id="currentRisk">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ü—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è</div>
                <div class="stat-value" id="previousCases">-</div>
                <div class="stat-date" id="previousDate">-</div>
                <div class="stat-risk" id="previousRisk">-</div>
            </div>
        </div>

        <!-- Map Section -->
        <div class="card">
            <div class="card-header">
                <h2>–ö–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–µ—â–µ–π</h2>
                <div class="map-controls">
                    <select id="mapView" class="map-select" onchange="updateMapView()">
                        <option value="all">–í—Å–µ –¥–∞–Ω–Ω—ã–µ</option>
                        <option value="week">–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è</option>
                        <option value="month">–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</option>
                    </select>
                </div>
            </div>
            <div class="card-body">
                <div id="map" class="map-container"></div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div class="card">
            <div class="card-header">
                <h2>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –≥–æ–¥–∞–º–∏</h2>
            </div>
            <div class="card-body">
                <canvas id="comparisonChart"></canvas>
            </div>
        </div>

        <!-- Graph Section -->
        <div class="card">
            <div class="card-header">
                <h2>–î–∏–Ω–∞–º–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
                <div class="filter-group">
                    <input type="date" id="startDate" class="date-input">
                    <input type="date" id="endDate" class="date-input">
                    <button class="btn btn-secondary" onclick="applyFilter()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
                    <button class="btn btn-secondary" onclick="clearFilter()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>
            <div class="card-body">
                <canvas id="activityChart"></canvas>
            </div>
        </div>

        <!-- Sources Section with Filters -->
        <div class="card">
            <div class="card-header">
                <h2>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h2>
                <div class="filter-group">
                    <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫..." onkeyup="applySourceFilters()">
                    <select id="locationFilter" class="filter-select" onchange="applySourceFilters()">
                        <option value="">–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏</option>
                    </select>
                    <select id="sourceFilter" class="filter-select" onchange="applySourceFilters()">
                        <option value="">–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</option>
                    </select>
                    <select id="riskFilter" class="filter-select" onchange="applySourceFilters()">
                        <option value="">–í—Å–µ —É—Ä–æ–≤–Ω–∏ —Ä–∏—Å–∫–∞</option>
                        <option value="–ù–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option>
                        <option value="–£–º–µ—Ä–µ–Ω–Ω—ã–π">–£–º–µ—Ä–µ–Ω–Ω—ã–π</option>
                        <option value="–í—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option>
                        <option value="–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π">–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π</option>
                    </select>
                </div>
            </div>
            <div class="card-body">
                <canvas id="activityChart"></canvas>
            </div>
        </div>

        <!-- News Feed Section -->
        <div class="card">
            <div class="card-header">
                <h2>–õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</h2>
                <p class="card-subtitle">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö</p>
            </div>
            <div class="card-body">
                <div id="newsFeed" class="news-feed">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</div>
                </div>
            </div>
        </div>

        <!-- Forecast Section -->
        <div class="card">
            <div class="card-header">
                <h2>–ü—Ä–æ–≥–Ω–æ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ 2026 –≥–æ–¥</h2>
                <p class="card-subtitle">–ù–∞ –æ—Å–Ω–æ–≤–µ ML –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 2024-2025 –≥–æ–¥—ã</p>
            </div>
            <div class="card-body">
                <canvas id="forecastChart"></canvas>
                <div id="forecastTable" class="forecast-table"></div>
            </div>
        </div>

        <!-- Sources Section with Filters -->
        <div class="card">
            <div class="card-header">
                <h2>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h2>
                <div class="filter-group">
                    <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫..." onkeyup="applySourceFilters()">
                    <select id="locationFilter" class="filter-select" onchange="applySourceFilters()">
                        <option value="">–í—Å–µ –ª–æ–∫–∞—Ü–∏–∏</option>
                    </select>
                    <select id="sourceFilter" class="filter-select" onchange="applySourceFilters()">
                        <option value="">–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</option>
                    </select>
                    <select id="riskFilter" class="filter-select" onchange="applySourceFilters()">
                        <option value="">–í—Å–µ —É—Ä–æ–≤–Ω–∏ —Ä–∏—Å–∫–∞</option>
                        <option value="–ù–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option>
                        <option value="–£–º–µ—Ä–µ–Ω–Ω—ã–π">–£–º–µ—Ä–µ–Ω–Ω—ã–π</option>
                        <option value="–í—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option>
                        <option value="–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π">–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π</option>
                    </select>
                </div>
            </div>
            <div class="card-body">
                <div id="sourcesList" class="sources-list">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button id="loadMoreBtn" class="btn btn-secondary" onclick="loadMoreSources()" style="display: none;">
                        –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ <a href="https://anverali.ru/" target="_blank" rel="noopener noreferrer">–ê–Ω–≤–µ—Ä–∞–ª–∏</a></p>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</p>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}?v=2.2"></script>
</body>
</html>

